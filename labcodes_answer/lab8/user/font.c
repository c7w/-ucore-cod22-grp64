#include <ulib.h>
#include <string.h>
#include <dir.h>
#include <file.h>
#include <error.h>
#include <stdio.h>
#include <unistd.h>

#define ll long long

#define WIDTH 100
#define HEIGHT 75
#define FPS 10
#define SECOND 60
#define VIDEO_LENGTH FPS * SECOND

#define printf(...)                     fprintf(1, __VA_ARGS__)

typedef unsigned char uint8_t;

typedef unsigned int uint32_t;
/*
 * rasterized font mapping
 */
uint8_t fonts[0xFF][0xF] = {
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x00 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x01 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x02 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x03 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x04 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x05 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x06 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x07 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x08 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x09 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x0A <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x0B <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x0C <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x0D <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x0E <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x0F <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x10 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x11 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x12 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x13 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x14 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x15 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x16 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x17 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x18 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x19 <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x1A <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x1B <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x1C <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x1D <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x1E <not printable>
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,   // ASCII: 0x1F <not printable>
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,   // ASCII: 0x20  
0x00, 0x00, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00, 0x00, 0x00, 0x1C, 0x00,   // ASCII: 0x21 !
0x00, 0x00, 0x36, 0x36, 0x36, 0x36, 0x36, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,   // ASCII: 0x22 "
0x00, 0x00, 0x44, 0x64, 0x24, 0x24, 0x7F, 0x26, 0x22, 0x32, 0x7F, 0x12, 0x12, 0x11, 0x00,   // ASCII: 0x23 #
0x08, 0x08, 0x3C, 0x3E, 0x6B, 0x0B, 0x0E, 0x1E, 0x38, 0x68, 0x6B, 0x6B, 0x3E, 0x1C, 0x08,   // ASCII: 0x24 $
0x00, 0x00, 0xC7, 0x45, 0x24, 0x34, 0x17, 0x08, 0x08, 0x74, 0xD6, 0x92, 0xD1, 0x71, 0x00,   // ASCII: 0x25 %
0x00, 0x00, 0x1E, 0x36, 0x23, 0x02, 0x06, 0x06, 0x4D, 0x79, 0x31, 0x31, 0x7B, 0xCE, 0x00,   // ASCII: 0x26 &
0x00, 0x00, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,   // ASCII: 0x27 '
0x00, 0x20, 0x30, 0x18, 0x0C, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x0C, 0x18, 0x30,   // ASCII: 0x28 (
0x00, 0x02, 0x06, 0x0C, 0x18, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x18, 0x0C, 0x06,   // ASCII: 0x29 )
0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x49, 0x6B, 0x3E, 0x14, 0x14, 0x36, 0x22, 0x00, 0x00,   // ASCII: 0x2A *
0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x08, 0x08, 0x08, 0x7F, 0x08, 0x08, 0x08, 0x00, 0x00,   // ASCII: 0x2B +
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x0C, 0x0C,   // ASCII: 0x2C ,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,   // ASCII: 0x2D -
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x1C, 0x1C, 0x00,   // ASCII: 0x2E .
0x00, 0x60, 0x20, 0x30, 0x30, 0x10, 0x18, 0x18, 0x08, 0x0C, 0x0C, 0x04, 0x06, 0x06, 0x02,   // ASCII: 0x2F /
0x00, 0x00, 0x1C, 0x36, 0x63, 0x63, 0x63, 0x6B, 0x6B, 0x63, 0x63, 0x63, 0x36, 0x1C, 0x00,   // ASCII: 0x30 0
0x00, 0x00, 0x1C, 0x1E, 0x1B, 0x19, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x7F, 0x00,   // ASCII: 0x31 1
0x00, 0x00, 0x1C, 0x36, 0x63, 0x63, 0x60, 0x20, 0x30, 0x18, 0x0C, 0x06, 0x03, 0x7F, 0x00,   // ASCII: 0x32 2
0x00, 0x00, 0x3F, 0x20, 0x10, 0x18, 0x1C, 0x3C, 0x60, 0x60, 0x60, 0x63, 0x37, 0x1E, 0x00,   // ASCII: 0x33 3
0x00, 0x00, 0x30, 0x18, 0x08, 0x0C, 0x06, 0x22, 0x23, 0x21, 0x3F, 0x20, 0x20, 0x20, 0x00,   // ASCII: 0x34 4
0x00, 0x00, 0x3E, 0x02, 0x02, 0x03, 0x3F, 0x37, 0x60, 0x60, 0x60, 0x63, 0x36, 0x1C, 0x00,   // ASCII: 0x35 5
0x00, 0x00, 0x18, 0x08, 0x0C, 0x04, 0x06, 0x3A, 0x67, 0x63, 0x41, 0x63, 0x76, 0x1C, 0x00,   // ASCII: 0x36 6
0x00, 0x00, 0x7F, 0x43, 0x63, 0x20, 0x20, 0x30, 0x10, 0x18, 0x18, 0x08, 0x0C, 0x0C, 0x00,   // ASCII: 0x37 7
0x00, 0x00, 0x1C, 0x36, 0x63, 0x63, 0x22, 0x1C, 0x36, 0x63, 0x41, 0x63, 0x77, 0x3E, 0x00,   // ASCII: 0x38 8
0x00, 0x00, 0x1C, 0x36, 0x63, 0x41, 0x63, 0x63, 0x3E, 0x30, 0x10, 0x18, 0x08, 0x0C, 0x00,   // ASCII: 0x39 9
0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x1C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x1C, 0x00,   // ASCII: 0x3A :
0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x1C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x0C, 0x0C,   // ASCII: 0x3B ;
0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x70, 0x1C, 0x07, 0x03, 0x0C, 0x70, 0x40, 0x00, 0x00,   // ASCII: 0x3C <
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00,   // ASCII: 0x3D =
0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x07, 0x1C, 0x70, 0x60, 0x18, 0x06, 0x01, 0x00, 0x00,   // ASCII: 0x3E >
0x00, 0x00, 0x1E, 0x30, 0x20, 0x20, 0x20, 0x30, 0x1C, 0x04, 0x04, 0x00, 0x00, 0x0C, 0x00,   // ASCII: 0x3F ?
0x00, 0x00, 0x3C, 0x66, 0x43, 0x41, 0x79, 0x49, 0x49, 0x49, 0x49, 0x49, 0x79, 0x01, 0x03,   // ASCII: 0x40 @
0x00, 0x00, 0x1C, 0x1C, 0x14, 0x14, 0x36, 0x36, 0x22, 0x22, 0x3E, 0x63, 0x63, 0x41, 0x00,   // ASCII: 0x41 A
0x00, 0x00, 0x1F, 0x33, 0x63, 0x63, 0x23, 0x1F, 0x23, 0x63, 0x43, 0x63, 0x73, 0x3F, 0x00,   // ASCII: 0x42 B
0x00, 0x00, 0x1C, 0x36, 0x63, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x63, 0x36, 0x1C, 0x00,   // ASCII: 0x43 C
0x00, 0x00, 0x1F, 0x33, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x33, 0x1F, 0x00,   // ASCII: 0x44 D
0x00, 0x00, 0x7F, 0x03, 0x03, 0x03, 0x03, 0x3F, 0x03, 0x03, 0x03, 0x03, 0x03, 0x7F, 0x00,   // ASCII: 0x45 E
0x00, 0x00, 0x7F, 0x03, 0x03, 0x03, 0x03, 0x03, 0x7F, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00,   // ASCII: 0x46 F
0x00, 0x00, 0x1C, 0x36, 0x63, 0x03, 0x03, 0x03, 0x7B, 0x63, 0x63, 0x63, 0x36, 0x1C, 0x00,   // ASCII: 0x47 G
0x00, 0x00, 0x63, 0x63, 0x63, 0x63, 0x63, 0x7F, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x00,   // ASCII: 0x48 H
0x00, 0x00, 0x3E, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x3E, 0x00,   // ASCII: 0x49 I
0x00, 0x00, 0x3C, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x21, 0x21, 0x33, 0x1E, 0x00,   // ASCII: 0x4A J
0x00, 0x00, 0x63, 0x63, 0x33, 0x33, 0x13, 0x1F, 0x1B, 0x13, 0x33, 0x23, 0x63, 0x43, 0x00,   // ASCII: 0x4B K
0x00, 0x00, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x7E, 0x00,   // ASCII: 0x4C L
0x00, 0x00, 0x63, 0x63, 0x55, 0x55, 0x55, 0x55, 0x49, 0x41, 0x41, 0x41, 0x41, 0x41, 0x00,   // ASCII: 0x4D M
0x00, 0x00, 0x63, 0x67, 0x67, 0x67, 0x6F, 0x6B, 0x6B, 0x7B, 0x73, 0x73, 0x73, 0x63, 0x00,   // ASCII: 0x4E N
0x00, 0x00, 0x1C, 0x36, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x36, 0x1C, 0x00,   // ASCII: 0x4F O
0x00, 0x00, 0x3F, 0x63, 0x43, 0x43, 0x43, 0x63, 0x3F, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00,   // ASCII: 0x50 P
0x00, 0x00, 0x1C, 0x36, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x36, 0x1C, 0x30,   // ASCII: 0x51 Q
0x00, 0x00, 0x3F, 0x73, 0x63, 0x43, 0x63, 0x63, 0x3F, 0x13, 0x33, 0x33, 0x63, 0x63, 0x00,   // ASCII: 0x52 R
0x00, 0x00, 0x1C, 0x36, 0x63, 0x03, 0x02, 0x1E, 0x38, 0x60, 0x40, 0x63, 0x77, 0x3C, 0x00,   // ASCII: 0x53 S
0x00, 0x00, 0x7F, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00,   // ASCII: 0x54 T
0x00, 0x00, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x36, 0x1C, 0x00,   // ASCII: 0x55 U
0x00, 0x00, 0x41, 0x63, 0x63, 0x22, 0x22, 0x22, 0x36, 0x36, 0x14, 0x14, 0x14, 0x1C, 0x00,   // ASCII: 0x56 V
0x00, 0x00, 0xC9, 0x49, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x77, 0x77, 0x22, 0x00,   // ASCII: 0x57 W
0x00, 0x00, 0x63, 0x63, 0x36, 0x36, 0x14, 0x1C, 0x1C, 0x14, 0x36, 0x22, 0x63, 0x41, 0x00,   // ASCII: 0x58 X
0x00, 0x00, 0xC1, 0x63, 0x22, 0x26, 0x36, 0x14, 0x1C, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00,   // ASCII: 0x59 Y
0x00, 0x00, 0x7F, 0x60, 0x30, 0x30, 0x18, 0x18, 0x0C, 0x04, 0x06, 0x02, 0x03, 0x7F, 0x00,   // ASCII: 0x5A Z
0x3C, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x3C,   // ASCII: 0x5B [
0x00, 0x03, 0x02, 0x06, 0x06, 0x04, 0x0C, 0x0C, 0x08, 0x18, 0x18, 0x10, 0x30, 0x30, 0x20,   // ASCII: 0x5C 
0x1E, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x1E,   // ASCII: 0x5D ]
0x00, 0x00, 0x08, 0x1C, 0x14, 0x14, 0x22, 0x22, 0x63, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,   // ASCII: 0x5E ^
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F,   // ASCII: 0x5F _
0x00, 0x06, 0x0C, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,   // ASCII: 0x60 `
0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x36, 0x63, 0x60, 0x7E, 0x63, 0x61, 0x73, 0x6E, 0x00,   // ASCII: 0x61 a
0x00, 0x00, 0x03, 0x03, 0x03, 0x3B, 0x37, 0x63, 0x63, 0x63, 0x63, 0x63, 0x37, 0x3B, 0x00,   // ASCII: 0x62 b
0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x36, 0x63, 0x03, 0x03, 0x03, 0x63, 0x36, 0x1C, 0x00,   // ASCII: 0x63 c
0x00, 0x00, 0x60, 0x60, 0x60, 0x6E, 0x76, 0x63, 0x63, 0x63, 0x63, 0x63, 0x76, 0x6E, 0x00,   // ASCII: 0x64 d
0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x36, 0x63, 0x63, 0x7F, 0x03, 0x03, 0x76, 0x3C, 0x00,   // ASCII: 0x65 e
0x00, 0x00, 0x78, 0x0C, 0x0C, 0x0C, 0x7F, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x00,   // ASCII: 0x66 f
0x00, 0x00, 0x00, 0x00, 0x00, 0x7E, 0x76, 0x63, 0x63, 0x63, 0x63, 0x63, 0x7E, 0x60, 0x60,   // ASCII: 0x67 g
0x00, 0x00, 0x03, 0x03, 0x03, 0x3B, 0x37, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x00,   // ASCII: 0x68 h
0x00, 0x00, 0x1C, 0x08, 0x00, 0x1E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x7F, 0x00,   // ASCII: 0x69 i
0x00, 0x00, 0x38, 0x10, 0x00, 0x3F, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x10,   // ASCII: 0x6A j
0x00, 0x00, 0x03, 0x03, 0x03, 0x63, 0x23, 0x33, 0x13, 0x1F, 0x13, 0x33, 0x23, 0x63, 0x00,   // ASCII: 0x6B k
0x00, 0x00, 0x0F, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x78, 0x00,   // ASCII: 0x6C l
0x00, 0x00, 0x00, 0x00, 0x00, 0x7D, 0x6F, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x00,   // ASCII: 0x6D m
0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x37, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x00,   // ASCII: 0x6E n
0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x36, 0x63, 0x63, 0x63, 0x63, 0x63, 0x36, 0x1C, 0x00,   // ASCII: 0x6F o
0x00, 0x00, 0x00, 0x00, 0x00, 0x3B, 0x37, 0x63, 0x63, 0x63, 0x63, 0x63, 0x37, 0x3B, 0x03,   // ASCII: 0x70 p
0x00, 0x00, 0x00, 0x00, 0x00, 0x6E, 0x76, 0x63, 0x63, 0x63, 0x63, 0x63, 0x76, 0x6E, 0x60,   // ASCII: 0x71 q
0x00, 0x00, 0x00, 0x00, 0x00, 0x3A, 0x76, 0x62, 0x42, 0x02, 0x02, 0x02, 0x02, 0x02, 0x00,   // ASCII: 0x72 r
0x00, 0x00, 0x00, 0x00, 0x00, 0x3E, 0x66, 0x03, 0x06, 0x3C, 0x60, 0x60, 0x67, 0x3E, 0x00,   // ASCII: 0x73 s
0x00, 0x00, 0x0C, 0x0C, 0x0C, 0x7F, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x78, 0x00,   // ASCII: 0x74 t
0x00, 0x00, 0x00, 0x00, 0x00, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x36, 0x1C, 0x00,   // ASCII: 0x75 u
0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0x63, 0x63, 0x22, 0x36, 0x36, 0x14, 0x14, 0x1C, 0x00,   // ASCII: 0x76 v
0x00, 0x00, 0x00, 0x00, 0x00, 0xC9, 0x4D, 0x55, 0x55, 0x55, 0x55, 0x77, 0x36, 0x22, 0x00,   // ASCII: 0x77 w
0x00, 0x00, 0x00, 0x00, 0x00, 0x63, 0x22, 0x36, 0x1C, 0x08, 0x14, 0x36, 0x22, 0x63, 0x00,   // ASCII: 0x78 x
0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0x63, 0x22, 0x26, 0x36, 0x14, 0x1C, 0x1C, 0x08, 0x08,   // ASCII: 0x79 y
0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x60, 0x30, 0x18, 0x08, 0x0C, 0x06, 0x03, 0x7F, 0x00,   // ASCII: 0x7A z
0x70, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x07, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x70,   // ASCII: 0x7B {
0x00, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08,   // ASCII: 0x7C |
0x07, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x70, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x07,   // ASCII: 0x7D }
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x46, 0x49, 0x79, 0x00, 0x00, 0x00, 0x00, 0x00,   // ASCII: 0x7E ~
};


ll get_time() {
    int* mtime = 0x200BFF8;
    int* mtime_upper = 0x200BFFC;
    ll time = ((ll)(*mtime_upper) << 32) + *mtime;
    return time;
}

void wait_for_tick(ll wait_until) {
    while( get_time() <= wait_until ) {
        // Wait
        __asm__ __volatile__ ("nop");
    }
}

/*
 * Font matrix 20 * 50
 *    (0, 0)--------> x
 *    |
 *    |
 *    |
 *    V
 *    y
 *  
 *   a single glyph is 15 * 8, which is 15 bytes
 */

/*
 * display buffer
 */
char s_buffer[0x100];
int lines[0x100];
uint8_t m_buffer[0x1000];

void slp(int sec) {
    ll curr_time = get_time();
    wait_for_tick(curr_time + 10000000 * sec);
}

/*
 * render `c` @ (x, y)
 */
void render(uint8_t x, uint8_t y, char c) {
    for (int i = 0; i < 15; ++i) {
        uint32_t adr = m_buffer + 50 * 15 * y + x + 50 * i;
        uint32_t dst_val = fonts[c][i] << ((adr % 4) * 8);
        adr = (adr >> 2) << 2;
        cprintf("%08x: %08x\n", adr, dst_val);
        *(uint32_t *)(adr) = dst_val;
        ll curr_time = get_time();
        // wait_for_tick(curr_time + 10000000 * 2);
    }
}

/*
 * Set display mode, 1 for 8-bit colored, 0 for binary
 */
void set_display(int mode) {
    *(int *)(0x81003ffc) = mode;
}

void clear() {
    for (int i = 0; i < 300 * 400 / 8; i += 4) {
        *(int *)(0x81000000 + i) = 0;
    }
}



void render_buffer(char *buf) {

}

int main() {
    printf("Display fonts.\n");
    set_display(0);

    clear();
    render(0, 0, 0);
    render(0, 1, 0);
    render(0, 2, 0);
    render(0, 3, 'D');

    cprintf("test\n");

    for (int i = 0; i < 45 * 400 / 8; i += 4) {
        *(uint32_t *)(0x81000000 + i) = *(uint32_t *)((uint8_t *)(m_buffer) + i);
        cprintf("%d: %08x\n", i, *(uint32_t *)((uint8_t *)(m_buffer) + i));
    }

    // clear();

    // render(0, 1, 0);
    // clear();

    // render(1, 0, 0);

    
    // for (int i = 0; i < 20; ++i ) {
    //     ll curr_time = get_time();
    //     for (int j = 0; j < 50; ++j) {
    //         clear();
    //         wait_for_tick(curr_time + 10000000 / 1);
    //         render(j, i, j + 'A');
    //     }
    //     wait_for_tick(curr_time + 10000000 / 1);
    // }

    // for (int i = 0; i < 50 * 50; i += 4) {
    //     *(unsigned int *)(0x81000000 + i) = 0xFFFFFFFF;
    //     ll curr_time = get_time();
    //     wait_for_tick(curr_time + 1000000);
    // }

    // slp(1);
    // clear();
    // slp(1);


    printf("font pass.\n");
    return 0;
}
